<html>
	<head>
		<style>
			#__history { color: silver; }
			#__currentSection { color: black; }
			.__disabledLink { color: silver; text-decoration: underline; }
		</style>
		<script>var Core = (function () {
    function Core() {
    }
    Core.ExpandMacro = function (macro) {
        switch (macro[0]) {
            case '@':
                {
                    return Core.ExpandSection(macro.substring(1));
                }
            case '#':
                {
                    var functionName = macro.substring(1);
                    var fn = window[functionName];
                    if (typeof fn === "function") {
                        return fn();
                    }
                    else {
                        console.log(functionName + " is not a function");
                        break;
                    }
                }
            case '$':
                {
                    return window[macro.substring(1)];
                }
        }
        console.log("Unknown metacharacter in macro: " + macro);
        return "";
    };
    Core.ExpandSection = function (id) {
        var section = document.getElementById(id);
        if (section) {
            var finalHTML = '';
            var macro = '';
            var bParsingMacro = false;
            for (var i = 0; i < section.innerHTML.length; i++) {
                if (section.innerHTML[i] === '{') {
                    if (!bParsingMacro) {
                        bParsingMacro = true;
                        macro = '';
                    }
                    else {
                        console.log("Error: Nested { in " + id + " at character " + i.toString());
                        break;
                    }
                }
                else if (section.innerHTML[i] === '}') {
                    if (bParsingMacro) {
                        bParsingMacro = false;
                        finalHTML += Core.ExpandMacro(macro);
                    }
                    else {
                        console.log("Error: Got } without a corresponding { in " + id + " at character " + i.toString());
                        break;
                    }
                }
                else if (bParsingMacro) {
                    macro += section.innerHTML[i];
                }
                else {
                    finalHTML += section.innerHTML[i];
                }
            }
            return finalHTML;
        }
        else {
            console.log("Section " + id + " doesn't exist");
            return '';
        }
    };
    Core.GotoSection = function (id) {
        var history = document.getElementById("__history");
        var currentSection = document.getElementById("__currentSection");
        var links = currentSection.getElementsByTagName("a");
        for (var i = 0; i < links.length;) {
            var contents = links[i].outerHTML.substring(links[i].outerHTML.indexOf(">") + 1, links[i].outerHTML.indexOf("</a>"));
            links[i].outerHTML = "<span class=\"__disabledLink\">" + contents + "</span>";
        }
        history.innerHTML += currentSection.innerHTML;
        currentSection.innerHTML = Core.ExpandSection(id);
    };
    Core.ShowHistory = function (tf) {
        var history = document.getElementById("__history");
        history.hidden = !tf;
    };
    return Core;
}());
// script.js
function HideHistory()
{
	Core.ShowHistory(false);
}

function FunctionLink()
{
	alert("It might look like this, if your function was programmed to raise a browser alert (as this one was). Other functions could do complex logic to choose different sections to go to based on things like player state (do you have a certain item in your inventory?) or even a random roll of the dice!");
}

function VariableLink()
{
	alert("You'll actually get a compiler error, because it doesn't make sense to link to a variable. In this case, I've linked to a function instead; specifically, one that shows you this alert.");
}

function InlineFunction()
{
	return "This paragraph is some inline text that comes from a function call! In this case, I put a \
function macro in my story text, then had the function return the text I wanted to display. In a real \
game, you could have the function do some kind of game logic that decides what to display; for instance, \
you could have it check if the player has a particular inventory item, and say one thing if they do \
and something different if they don't.";
}

var InlineVariable = "\"Hello, world!\"";

function RaiseAlert()
{
	alert("fractive is super cool!");
}

</script>
	</head>
	<body>
		<!-- text.md -->
<div id="Start" class="section" hidden="true"><h1>Welcome!</h1>
<p>Welcome to fractive, a tool for creating hypertext fiction!</p>
<p>Fractive stories are written in Markdown, and you can add (optional) game logic in Javascript. Stories consist of &quot;sections&quot;, which you might think of like one page of a book. Typically a section will give you a bit of narrative and then present one or more choices to the player; each choice takes the story to a different section, and in a different direction.</p>
<p>In Markdown, you declare the beginning of a new section by enclosing the section name (which must be unique!) in double curly braces. The section you're reading right now is called <code>Start</code> which is a special section name that indicates where the story begins.</p>
<p><a href="#" onclick="Core.GotoSection('AnotherSection')">Link to another section</a></p>
</div>
<div id="AnotherSection" class="section" hidden="true"><p>You just clicked a link that took you to another section! You create section links just like any ol' Markdown link, but in place of the URL you put a special <em>macro</em> enclosed in single curly braces. There are three types of macros, each denoted by a symbol:</p>
<ul>
<li>@ denotes a section name to link to</li>
<li># denotes a Javascript function to call</li>
<li>$ denotes a Javascript variable</li>
</ul>
<p>So if you put inside the curly braces <code>@Start</code> you'd have created a link back to the section called <code>Start</code>. If on the other hand you'd put <code>#Start</code> you'd have created a link that would call a Javascript function called <code>Start</code>.</p>
<p><a href="#" onclick="FunctionLink()">What does it look like when a link calls a Javascript function?</a><br/><a href="#" onclick="VariableLink()">What happens if I set the link URL to a variable macro?</a><br/><a href="#" onclick="Core.GotoSection('InlineMacros')">What else can I use macros for?</a></p>
<p>(P.S. Notice that the first section is still displayed above. That's because we keep track of your play history in a scrollback. You can <a href="#" onclick="HideHistory()">hide the history</a> if you like. The UX for this is still going to need some work.)</p>
</div>
<div id="InlineMacros" class="section" hidden="true"><p>Macros aren't only for links; you can also use them to add dynamic text to your sections.</p>
<blockquote>
<p>{#InlineFunction}</p>
</blockquote>
<p>The above paragraph was the result of inlining a function call, which expects the function to return a string. You can also inline the value of a variable. Here's one: {$InlineVariable}</p>
<p>And finally, you can inline an entire section:</p>
<blockquote>
<p>{@InlineSection}</p>
</blockquote>
<p>The inlined function and section above are indented, but that's only because I prefaced them with the Markdown blockquote indicator for clarity. Inlines don't inherently get any special styling, so you can inline things totally seamlessly and your players will never know the difference.</p>
<p><a href="#" onclick="Core.GotoSection('AboutFormatting')">So I can use Markdown styling, too?</a></p>
</div>
<div id="InlineSection" class="section" hidden="true"><p>This paragraph was written in an entirely different section, but it appears as part of the section you're already reading. This might be useful if you have some boilerplate text that needs to follow the player around from place to place; you could put it in a section and inline it, instead of copy-pasting the same sentences (or paragraphs) all over your story text.</p>
</div>
<div id="AboutFormatting" class="section" hidden="true"><p>Story text is written in Markdown, which means we have access to <em>all kinds</em> of <strong>formatting</strong>, including:</p>
<h1>Headers</h1>
<h2>Sub-headers</h2>
<ul>
<li>Unordered lists (like this one)</li>
<li>Ordered lists (1, 2, 3, 4...)</li>
<li>Links can also <a href="#" onclick="RaiseAlert()"><em>contain</em> <strong>formatting</strong></a></li>
</ul>
<p>Basically, anything Markdown can do, you can do in your story text! You can even inline <span style="color:#ff0000">raw HTML</span> which means you could do video embeds, HTML5 canvas, and all kinds of other fancy stuff.</p>
<p>And of course, because fractive games are ultimately HTML in the end, you can create your own HTML template with whatever layout you want, and style it with CSS. For example, you could surround your game with a header and footer, or create a sidebar which (along with some custom Javascript) tracks your player's inventory and stats as they move through the story.</p>
<p><a href="#" onclick="Core.GotoSection('LongStories')">How does fractive handle long/complicated stories?</a></p>
</div>
<div id="LongStories" class="section" hidden="true"><p>Fractive's main goal is to be the best tool for writing complex, dynamic hypertext fiction that has lots of branches and genuinely consequential choices. What you're reading right now is produced by a <em>very</em> eary version of the tool, so this goal isn't fully realized yet, but it is the direction I'm heading.</p>
<p>You can split long story text up into as many individual Markdown files as you like, and they can be named whatever you like. The same goes for game logic in Javascript; you could have separate .js files for each logical class, or for each scene or major location in your story, or however else you'd like to organize it. When you publish your story, all the files in the story source folder are gathered up automatically, and everything gets compiled together into a single self-contained HTML file.</p>
<p>In the future I'll be exploring additional tools and visualizations to help authors understand, trace, and debug the complexity of large, deeply-branching narratives. Those tools and visualizers will likely be the most experimental, and pivotal, aspects of fractive's development.</p>
<p>Anything you'd like to review?</p>
<p><a href="#" onclick="FunctionLink()">What does it look like when a link calls a Javascript function?</a><br/><a href="#" onclick="VariableLink()">What happens if I set the link URL to a variable macro?</a><br/><a href="#" onclick="Core.GotoSection('InlineMacros')">What else can I use macros for?</a><br/><a href="#" onclick="Core.GotoSection('AboutFormatting')">So I can use Markdown styling, too?</a></p>
</div>


		<div id="__history"></div>
		<hr/>
		<div id="__currentSection"></div>
	</body>
</html>
<script>Core.GotoSection("Start");</script>